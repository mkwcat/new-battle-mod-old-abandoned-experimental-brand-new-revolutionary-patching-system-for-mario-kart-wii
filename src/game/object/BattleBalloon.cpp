#include "BattleBalloon.h"
#include "game/sys/RaceConfig.h"

REPLACE(0x80869884, object::BattleBalloonMgr::BattleBalloonMgr())
{
    auto config = &sys::RaceConfig::s_instance->m_currentRace;

    m_playerCount = config->m_playerCount;

    if (config->m_modeFlags & sys::RaceConfig::RaceSetting::FLAG_TEAMS) {
        // Teams mode is only 2 colors: red and blue. You can't steal balloons
        // from your teammates, so assume that everyone can only have three
        // balloons from their own team.
        const int numTeamPlayers = (m_playerCount / 2) + (m_playerCount & 1);

        m_numOfEachType = numTeamPlayers * 3 + numTeamPlayers * 4;
        m_balloonCount = m_numOfEachType * 2;
    } else {
        // No teams, assuming there is only one of each color.
        m_numOfEachType = m_playerCount * 4 - 1;

        if (m_numOfEachType * m_playerCount > MaxBalloonCount) {
            // Not enough room for all balloons so let's just split them
            // equally.
            m_numOfEachType = MaxBalloonCount / m_playerCount;
        }

        m_balloonCount = m_numOfEachType * m_playerCount;
    }

    // Construct the balloon objects
    for (u8 i = 0; i < m_balloonCount; i++) {
        auto color = BattleBalloon::Color(i / m_numOfEachType);

        m_balloons[i].m_object = new BattleBalloon(i, color);

        // Hack but we don't have the generic object vtable yet.
        ((void (*)(BattleBalloon*)) m_balloons[i].m_object->m_vtable[0x20 / 4]
        )(m_balloons[i].m_object);

        m_balloons[i].m_color = u8(color);
    }
}

REPLACE_ASM(0x80869DF4,
            void object::BattleBalloonMgr::AddToPlayer(
              u32 playerId, u8 team, int param_4, int param_5, int param_6,
              int param_7
            ),
            // clang-format off
/* 80869DF4 9421FFC0 */  stwu     r1, -64(r1);
/* 80869DF8 7C0802A6 */  mflr     r0;
/* 80869DFC 28050002 */  // cmplwi   r5, 2;
/* 80869E00 90010044 */  stw      r0, 68(r1);
/* 80869E04 BEC10018 */  stmw     r22, 24(r1);
/* 80869E08 7C781B78 */  mr       r24, r3;
/* 80869E0C 7C992378 */  mr       r25, r4;
/* 80869E10 7CDA3378 */  mr       r26, r6;
/* 80869E14 7D3B4B78 */  mr       r27, r9;
/* 80869E18 41800008 */  // blt-     UNDEF_80869e20;
/* 80869E1C 38A00000 */  // li       r5, 0;

                         // Check to see if it's team mode or not
                         lis      r11, s_instance__Q23sys10RaceConfig@ha;
                         lwz      r11, s_instance__Q23sys10RaceConfig@l(r11);
                         lbz      r11, 0xB93(r11);
                         andi.    r11, r11, 2;
                         bne-     UNDEF_80869e20;
                         // Use the player ID as the balloon color
                         mr       r5, r25;


UNDEF_80869e20:;
/* 80869E20 1C040018 */  mulli    r0, r4, 24;
/* 80869E24 808304E4 */  lwz      r4, 1252(r3);
/* 80869E28 7F843A14 */  add      r28, r4, r7;
/* 80869E2C 7C830214 */  add      r4, r3, r0;
/* 80869E30 888403C4 */  lbz      r4, 964(r4);
/* 80869E34 20840005 */  subfic   r4, r4, 5;
/* 80869E38 7C044000 */  cmpw     r4, r8;
/* 80869E3C 41810008 */  bgt-     UNDEF_80869e44;
/* 80869E40 5488063E */  clrlwi   r8, r4, 24;
UNDEF_80869e44:;
/* 80869E44 88830002 */  lbz      r4, 2(r3);
/* 80869E48 39410008 */  addi     r10, r1, 8;
/* 80869E4C 38C00000 */  li       r6, 0;
/* 80869E50 38E00000 */  li       r7, 0;
/* 80869E54 4800007C */  b        UNDEF_80869ed0;
UNDEF_80869e58:;
/* 80869E58 54EB1D78 */  clrlslwi r11, r7, 24, 3;
/* 80869E5C 89230000 */  lbz      r9, 0(r3);
/* 80869E60 7D835A14 */  add      r12, r3, r11;
/* 80869E64 896C0009 */  lbz      r11, 9(r12);
/* 80869E68 7C0B4840 */  cmplw    r11, r9;
/* 80869E6C 41800060 */  blt-     UNDEF_80869ecc;
/* 80869E70 892C0008 */  lbz      r9, 8(r12);
/* 80869E74 7C054840 */  cmplw    r5, r9;
/* 80869E78 40820054 */  bne-     UNDEF_80869ecc;
/* 80869E7C 818C0004 */  lwz      r12, 4(r12);
/* 80869E80 82CC0180 */  lwz      r22, 384(r12);
/* 80869E84 816C0178 */  lwz      r11, 376(r12);
/* 80869E88 56C92036 */  slwi     r9, r22, 4;
/* 80869E8C 7D2B482E */  lwzx     r9, r11, r9;
/* 80869E90 2C090000 */  cmpwi    r9, 0;
/* 80869E94 40820038 */  bne-     UNDEF_80869ecc;
/* 80869E98 812C017C */  lwz      r9, 380(r12);
/* 80869E9C 39600000 */  li       r11, 0;
/* 80869EA0 7C09B040 */  cmplw    r9, r22;
/* 80869EA4 40820014 */  bne-     UNDEF_80869eb8;
/* 80869EA8 892C0185 */  lbz      r9, 389(r12);
/* 80869EAC 2C090000 */  cmpwi    r9, 0;
/* 80869EB0 41820008 */  beq-     UNDEF_80869eb8;
/* 80869EB4 39600001 */  li       r11, 1;
UNDEF_80869eb8:;
/* 80869EB8 2C0B0000 */  cmpwi    r11, 0;
/* 80869EBC 41820010 */  beq-     UNDEF_80869ecc;
/* 80869EC0 54C9063E */  clrlwi   r9, r6, 24;
/* 80869EC4 38C60001 */  addi     r6, r6, 1;
/* 80869EC8 7CEA49AE */  stbx     r7, r10, r9;
UNDEF_80869ecc:;
/* 80869ECC 38E70001 */  addi     r7, r7, 1;
UNDEF_80869ed0:;
/* 80869ED0 54E9063E */  clrlwi   r9, r7, 24;
/* 80869ED4 7C092040 */  cmplw    r9, r4;
/* 80869ED8 40800010 */  bge-     UNDEF_80869ee8;
/* 80869EDC 54C9063E */  clrlwi   r9, r6, 24;
/* 80869EE0 7C094040 */  cmplw    r9, r8;
/* 80869EE4 4180FF74 */  blt+     UNDEF_80869e58;
UNDEF_80869ee8:;
/* 80869EE8 39210008 */  addi     r9, r1, 8;
/* 80869EEC 39800000 */  li       r12, 0;
/* 80869EF0 48000038 */  b        UNDEF_80869f28;
UNDEF_80869ef4:;
/* 80869EF4 558A1D78 */  clrlslwi r10, r12, 24, 3;
/* 80869EF8 88E30000 */  lbz      r7, 0(r3);
/* 80869EFC 7D635214 */  add      r11, r3, r10;
/* 80869F00 894B0009 */  lbz      r10, 9(r11);
/* 80869F04 7C0A3840 */  cmplw    r10, r7;
/* 80869F08 4180001C */  blt-     UNDEF_80869f24;
/* 80869F0C 88EB0008 */  lbz      r7, 8(r11);
/* 80869F10 7C053840 */  cmplw    r5, r7;
/* 80869F14 40820010 */  bne-     UNDEF_80869f24;
/* 80869F18 54C7063E */  clrlwi   r7, r6, 24;
/* 80869F1C 38C60001 */  addi     r6, r6, 1;
/* 80869F20 7D8939AE */  stbx     r12, r9, r7;
UNDEF_80869f24:;
/* 80869F24 398C0001 */  addi     r12, r12, 1;
UNDEF_80869f28:;
/* 80869F28 5587063E */  clrlwi   r7, r12, 24;
/* 80869F2C 7C072040 */  cmplw    r7, r4;
/* 80869F30 40800010 */  bge-     UNDEF_80869f40;
/* 80869F34 54C7063E */  clrlwi   r7, r6, 24;
/* 80869F38 7C074040 */  cmplw    r7, r8;
/* 80869F3C 4180FFB8 */  blt+     UNDEF_80869ef4;
UNDEF_80869f40:;
/* 80869F40 7FC30214 */  add      r30, r3, r0;
/* 80869F44 3BE10008 */  addi     r31, r1, 8;
/* 80869F48 54D7063E */  clrlwi   r23, r6, 24;
/* 80869F4C 3BA00000 */  li       r29, 0;
/* 80869F50 48000060 */  b        UNDEF_80869fb0;
UNDEF_80869f54:;
/* 80869F54 57A3063E */  clrlwi   r3, r29, 24;
/* 80869F58 88DE03C4 */  lbz      r6, 964(r30);
/* 80869F5C 7C03D9D6 */  mullw    r0, r3, r27;
/* 80869F60 7C7F18AE */  lbzx     r3, r31, r3;
/* 80869F64 7F25CB78 */  mr       r5, r25;
/* 80869F68 54631838 */  slwi     r3, r3, 3;
/* 80869F6C 7F47D378 */  mr       r7, r26;
/* 80869F70 7ED81A14 */  add      r22, r24, r3;
/* 80869F74 80760004 */  lwz      r3, 4(r22);
/* 80869F78 7C9C0214 */  add      r4, r28, r0;
/* 80869F7C 48004CE1 */  bl       UNDEF_8086ec5c;
/* 80869F80 9B360009 */  stb      r25, 9(r22);
/* 80869F84 3BBD0001 */  addi     r29, r29, 1;
/* 80869F88 881E03C4 */  lbz      r0, 964(r30);
/* 80869F8C 9816000A */  stb      r0, 10(r22);
/* 80869F90 881E03C4 */  lbz      r0, 964(r30);
/* 80869F94 80960004 */  lwz      r4, 4(r22);
/* 80869F98 5400103A */  slwi     r0, r0, 2;
/* 80869F9C 7C7E0214 */  add      r3, r30, r0;
/* 80869FA0 908303C8 */  stw      r4, 968(r3);
UNDEF_80869fa4:;
/* 80869FA4 887E03C4 */  lbz      r3, 964(r30);
/* 80869FA8 38030001 */  addi     r0, r3, 1;
/* 80869FAC 981E03C4 */  stb      r0, 964(r30);
UNDEF_80869fb0:;
/* 80869FB0 57A0063E */  clrlwi   r0, r29, 24;
/* 80869FB4 7C00B840 */  cmplw    r0, r23;
/* 80869FB8 4180FF9C */  blt+     UNDEF_80869f54;
/* 80869FBC BAC10018 */  lmw      r22, 24(r1);
/* 80869FC0 80010044 */  lwz      r0, 68(r1);
/* 80869FC4 7C0803A6 */  mtlr     r0;
/* 80869FC8 38210040 */  addi     r1, r1, 64;
/* 80869FCC 4E800020 */  blr
            // clang-format on
);

const char* g_BalloonModels[] = {
  "ballon", "ballon_b", "yellow", "green",     "purple",    "brown",
  "orange", "pink",     "black",  "bluelight", "greendark", "bluedark",
};

REPLACE_ASM(
  0x8086E224, object::BattleBalloon::BattleBalloon(u32 index, Color color),
  // clang-format off
/* 8086E224 9421FF70 */  stwu     r1, -144(r1);
/* 8086E228 7C0802A6 */  mflr     r0;
/* 8086E22C 90010094 */  stw      r0, 148(r1);
/* 8086E230 DBE10080 */  stfd     f31, 128(r1);
/* 8086E234 F3E10088 */  .long    0xF3E10088; // psq_st   f31, 136(r1), 0, 0;
/* 8086E238 DBC10070 */  stfd     f30, 112(r1);
/* 8086E23C F3C10078 */  .long    0xF3C10078; // psq_st   f30, 120(r1), 0, 0;
/* 8086E240 39610070 */  addi     r11, r1, 112;
/* 8086E244 4B7B3351 */  bl       UNDEF_80021594;
/* 8086E248 3CC0808B */  lis      r6, UNDEF_808b2234@ha;
/* 8086E24C 3FC0808E */  lis      r30, UNDEF_808dc350@ha;
/* 8086E250 C0062234 */  lfs      f0, UNDEF_808b2234@l(r6);
/* 8086E254 3CC0802A */  lis      r6, UNDEF_802a4148@ha;
/* 8086E258 D0010044 */  stfs     f0, 68(r1);
/* 8086E25C 3D00808B */  lis      r8, UNDEF_808b2258@ha;
/* 8086E260 7C992378 */  mr       r25, r4;
/* 8086E264 3CE0802A */  lis      r7, UNDEF_802a4100@ha;
/* 8086E268 7CB82B78 */  mr       r24, r5;
/* 8086E26C 38882258 */  addi     r4, r8, UNDEF_808b2258@l;
/* 8086E270 38A74100 */  addi     r5, r7, UNDEF_802a4100@l;
/* 8086E274 D0010048 */  stfs     f0, 72(r1);
/* 8086E278 7C7B1B78 */  mr       r27, r3;
/* 8086E27C 3BDEC350 */  addi     r30, r30, UNDEF_808dc350@l;
/* 8086E280 D001004C */  stfs     f0, 76(r1);
/* 8086E284 38C64148 */  addi     r6, r6, UNDEF_802a4148@l;
/* 8086E288 38E10044 */  addi     r7, r1, 68;
/* 8086E28C 39000000 */  li       r8, 0;
/* 8086E290 4BFB0DD5 */  bl       UNDEF_8081f064;
/* 8086E294 3C60808E */  lis      r3, UNDEF_808dc448@ha;
/* 8086E298 9B3B00B0 */  stb      r25, 176(r27);
/* 8086E29C 3863C448 */  addi     r3, r3, UNDEF_808dc448@l;
/* 8086E2A0 38000005 */  li       r0, 5;
/* 8086E2A4 907B0000 */  stw      r3, 0(r27);
/* 8086E2A8 1C60001C */  mulli    r3, r0, 28;
/* 8086E2AC 9B1B00B1 */  stb      r24, 177(r27);
/* 8086E2B0 C3DE0074 */  lfs      f30, 116(r30);
/* 8086E2B4 937B0168 */  stw      r27, 360(r27);
/* 8086E2B8 901B016C */  stw      r0, 364(r27);
/* 8086E2BC 4B9BBB35 */  bl       UNDEF_80229df0;
/* 8086E2C0 3CC08024 */  lis      r6, UNDEF_802470a0@ha;
/* 8086E2C4 3C80808E */  lis      r4, UNDEF_808dc53c@ha;
/* 8086E2C8 907B0170 */  stw      r3, 368(r27);
/* 8086E2CC 38C670A0 */  addi     r6, r6, UNDEF_802470a0@l;
/* 8086E2D0 3884C53C */  addi     r4, r4, UNDEF_808dc53c@l;
/* 8086E2D4 38E00000 */  li       r7, 0;
/* 8086E2D8 39000000 */  li       r8, 0;
/* 8086E2DC 48000058 */  b        UNDEF_8086e334;
UNDEF_8086e2e0:;
/* 8086E2E0 807B0170 */  lwz      r3, 368(r27);
/* 8086E2E4 38E70001 */  addi     r7, r7, 1;
/* 8086E2E8 80060004 */  lwz      r0, 4(r6);
/* 8086E2EC 7CA34214 */  add      r5, r3, r8;
/* 8086E2F0 80660000 */  lwz      r3, 0(r6);
/* 8086E2F4 90650000 */  stw      r3, 0(r5);
/* 8086E2F8 90050004 */  stw      r0, 4(r5);
/* 8086E2FC 80060008 */  lwz      r0, 8(r6);
/* 8086E300 90050008 */  stw      r0, 8(r5);
/* 8086E304 807B0170 */  lwz      r3, 368(r27);
/* 8086E308 80060004 */  lwz      r0, 4(r6);
/* 8086E30C 7CA34214 */  add      r5, r3, r8;
/* 8086E310 80660000 */  lwz      r3, 0(r6);
/* 8086E314 9065000C */  stw      r3, 12(r5);
/* 8086E318 90050010 */  stw      r0, 16(r5);
/* 8086E31C 80060008 */  lwz      r0, 8(r6);
/* 8086E320 90050014 */  stw      r0, 20(r5);
/* 8086E324 801B0170 */  lwz      r0, 368(r27);
/* 8086E328 7C604214 */  add      r3, r0, r8;
/* 8086E32C 3908001C */  addi     r8, r8, 28;
/* 8086E330 90830018 */  stw      r4, 24(r3);
UNDEF_8086e334:;
/* 8086E334 801B016C */  lwz      r0, 364(r27);
/* 8086E338 7C070040 */  cmplw    r7, r0;
/* 8086E33C 4180FFA4 */  blt+     UNDEF_8086e2e0;
/* 8086E340 5403103A */  slwi     r3, r0, 2;
/* 8086E344 4B9BBAAD */  bl       UNDEF_80229df0;
/* 8086E348 907B0188 */  stw      r3, 392(r27);
/* 8086E34C 3B400000 */  li       r26, 0;
/* 8086E350 3B000000 */  li       r24, 0;
/* 8086E354 3B200000 */  li       r25, 0;
/* 8086E358 4800003C */  b        UNDEF_8086e394;
UNDEF_8086e35c:;
/* 8086E35C 4B9BBA95 */  bl       UNDEF_80229df0;
/* 8086E360 809B0188 */  lwz      r4, 392(r27);
/* 8086E364 38A00000 */  li       r5, 0;
/* 8086E368 7C64C12E */  stwx     r3, r4, r24;
/* 8086E36C 48000014 */  b        UNDEF_8086e380;
UNDEF_8086e370:;
/* 8086E370 801B0188 */  lwz      r0, 392(r27);
/* 8086E374 7C78002E */  lwzx     r3, r24, r0;
/* 8086E378 7F2329AE */  stbx     r25, r3, r5;
/* 8086E37C 38A50001 */  addi     r5, r5, 1;
UNDEF_8086e380:;
/* 8086E380 801B016C */  lwz      r0, 364(r27);
/* 8086E384 7C050040 */  cmplw    r5, r0;
/* 8086E388 4180FFE8 */  blt+     UNDEF_8086e370;
/* 8086E38C 3B180004 */  addi     r24, r24, 4;
/* 8086E390 3B5A0001 */  addi     r26, r26, 1;
UNDEF_8086e394:;
/* 8086E394 807B016C */  lwz      r3, 364(r27);
/* 8086E398 7C1A1840 */  cmplw    r26, r3;
/* 8086E39C 4180FFC0 */  blt+     UNDEF_8086e35c;
/* 8086E3A0 38000010 */  li       r0, 16;
/* 8086E3A4 901B0174 */  stw      r0, 372(r27);
/* 8086E3A8 38600100 */  li       r3, 256;
/* 8086E3AC 4B9BBA45 */  bl       UNDEF_80229df0;
/* 8086E3B0 907B0178 */  stw      r3, 376(r27);
/* 8086E3B4 38E00000 */  li       r7, 0;
/* 8086E3B8 39000000 */  li       r8, 0;
/* 8086E3BC 38C00000 */  li       r6, 0;
/* 8086E3C0 38A0FFFF */  li       r5, -1;
/* 8086E3C4 48000040 */  b        UNDEF_8086e404;
UNDEF_8086e3c8:;
/* 8086E3C8 807B0178 */  lwz      r3, 376(r27);
/* 8086E3CC 38E70001 */  addi     r7, r7, 1;
/* 8086E3D0 801B016C */  lwz      r0, 364(r27);
/* 8086E3D4 7C03412E */  stwx     r0, r3, r8;
/* 8086E3D8 801B0178 */  lwz      r0, 376(r27);
/* 8086E3DC 7C604214 */  add      r3, r0, r8;
/* 8086E3E0 90C30004 */  stw      r6, 4(r3);
/* 8086E3E4 801B0178 */  lwz      r0, 376(r27);
/* 8086E3E8 7C604214 */  add      r3, r0, r8;
/* 8086E3EC 90A30008 */  stw      r5, 8(r3);
/* 8086E3F0 801B0178 */  lwz      r0, 376(r27);
/* 8086E3F4 809B0174 */  lwz      r4, 372(r27);
/* 8086E3F8 7C604214 */  add      r3, r0, r8;
/* 8086E3FC 39080010 */  addi     r8, r8, 16;
/* 8086E400 9083000C */  stw      r4, 12(r3);
UNDEF_8086e404:;
/* 8086E404 801B0174 */  lwz      r0, 372(r27);
/* 8086E408 7C070040 */  cmplw    r7, r0;
/* 8086E40C 4180FFBC */  blt+     UNDEF_8086e3c8;
/* 8086E410 38000001 */  li       r0, 1;
/* 8086E414 D3DB018C */  stfs     f30, 396(r27);
/* 8086E418 1C600064 */  mulli    r3, r0, 100;
/* 8086E41C 901B01D4 */  stw      r0, 468(r27);
/* 8086E420 38630010 */  addi     r3, r3, 16;
/* 8086E424 4B9BB9CD */  bl       UNDEF_80229df0;
/* 8086E428 3C808087 */  lis      r4, UNDEF_8086c988@ha;
/* 8086E42C 3CA08087 */  lis      r5, UNDEF_8086c98c@ha;
/* 8086E430 3884C988 */  addi     r4, r4, UNDEF_8086c988@l;
/* 8086E434 38C00064 */  li       r6, 100;
/* 8086E438 38A5C98C */  addi     r5, r5, UNDEF_8086c98c@l;
/* 8086E43C 38E00001 */  li       r7, 1;
/* 8086E440 4B7B29F5 */  bl       UNDEF_80020e34;
/* 8086E444 3CA0808B */  lis      r5, UNDEF_808b2218@ha;
/* 8086E448 3C80808B */  lis      r4, UNDEF_808b2234@ha;
/* 8086E44C 907B01D8 */  stw      r3, 472(r27);
/* 8086E450 3BA00000 */  li       r29, 0;
/* 8086E454 C3C52218 */  lfs      f30, UNDEF_808b2218@l(r5);
/* 8086E458 3B800000 */  li       r28, 0;
/* 8086E45C C3E42234 */  lfs      f31, UNDEF_808b2234@l(r4);
/* 8086E460 3BE00000 */  li       r31, 0;
/* 8086E464 4800008C */  b        UNDEF_8086e4f0;
UNDEF_8086e468:;
/* 8086E468 807B01D8 */  lwz      r3, 472(r27);
/* 8086E46C 7FE3E12E */  stwx     r31, r3, r28;
/* 8086E470 801B01D8 */  lwz      r0, 472(r27);
/* 8086E474 7C60E214 */  add      r3, r0, r28;
/* 8086E478 9BE30004 */  stb      r31, 4(r3);
/* 8086E47C 801B01D8 */  lwz      r0, 472(r27);
/* 8086E480 7C60E214 */  add      r3, r0, r28;
/* 8086E484 93E30008 */  stw      r31, 8(r3);
/* 8086E488 801B01D8 */  lwz      r0, 472(r27);
/* 8086E48C 7C60E214 */  add      r3, r0, r28;
/* 8086E490 9BE3000C */  stb      r31, 12(r3);
/* 8086E494 801B01D8 */  lwz      r0, 472(r27);
/* 8086E498 7C60E214 */  add      r3, r0, r28;
/* 8086E49C 93E30010 */  stw      r31, 16(r3);
/* 8086E4A0 801B01D8 */  lwz      r0, 472(r27);
/* 8086E4A4 7C60E214 */  add      r3, r0, r28;
/* 8086E4A8 D3C3001C */  stfs     f30, 28(r3);
/* 8086E4AC D3C30018 */  stfs     f30, 24(r3);
/* 8086E4B0 D3C30014 */  stfs     f30, 20(r3);
/* 8086E4B4 801B01D8 */  lwz      r0, 472(r27);
/* 8086E4B8 7C60E214 */  add      r3, r0, r28;
/* 8086E4BC D3E30020 */  stfs     f31, 32(r3);
/* 8086E4C0 D3E30024 */  stfs     f31, 36(r3);
/* 8086E4C4 D3E30028 */  stfs     f31, 40(r3);
/* 8086E4C8 801B01D8 */  lwz      r0, 472(r27);
/* 8086E4CC 7C60E214 */  add      r3, r0, r28;
/* 8086E4D0 3863002C */  addi     r3, r3, 44;
/* 8086E4D4 4B9C15F1 */  bl       UNDEF_8022fac4;
/* 8086E4D8 801B01D8 */  lwz      r0, 472(r27);
/* 8086E4DC 3BBD0001 */  addi     r29, r29, 1;
/* 8086E4E0 7C60E214 */  add      r3, r0, r28;
/* 8086E4E4 3B9C0064 */  addi     r28, r28, 100;
/* 8086E4E8 D3E3005C */  stfs     f31, 92(r3);
/* 8086E4EC D3E30060 */  stfs     f31, 96(r3);
UNDEF_8086e4f0:;
/* 8086E4F0 801B01D4 */  lwz      r0, 468(r27);
/* 8086E4F4 7C1D0040 */  cmplw    r29, r0;
/* 8086E4F8 4180FF70 */  blt+     UNDEF_8086e468;
/* 8086E4FC 3C80809C */  lis      r4, UNDEF_809c18f8@ha;
/* 8086E500 3C60808B */  lis      r3, UNDEF_808b2258@ha;
/* 8086E504 808418F8 */  lwz      r4, UNDEF_809c18f8@l(r4);
/* 8086E508 38632258 */  addi     r3, r3, UNDEF_808b2258@l;
/* 8086E50C 38000000 */  li       r0, 0;
/* 8086E510 38BE0080 */  addi     r5, r30, 128;
/* 8086E514 88840024 */  lbz      r4, 36(r4);
/* 8086E518 397E008C */  addi     r11, r30, 140;
/* 8086E51C 989B00B2 */  stb      r4, 178(r27);
/* 8086E520 3B030009 */  addi     r24, r3, 9;
/* 8086E524 835B0170 */  lwz      r26, 368(r27);
/* 8086E528 395E0098 */  addi     r10, r30, 152;
/* 8086E52C 981B01E0 */  stb      r0, 480(r27);
/* 8086E530 393E00A4 */  addi     r9, r30, 164;
/* 8086E534 38030011 */  addi     r0, r3, 17;
/* 8086E538 391E00B0 */  addi     r8, r30, 176;
/* 8086E53C 83FE0080 */  lwz      r31, 128(r30);
/* 8086E540 38FE00BC */  addi     r7, r30, 188;
/* 8086E544 83850004 */  lwz      r28, 4(r5);
/* 8086E548 38830018 */  addi     r4, r3, 24;
/* 8086E54C 83A50008 */  lwz      r29, 8(r5);
/* 8086E550 38DE00C8 */  addi     r6, r30, 200;
/* 8086E554 818B0004 */  lwz      r12, 4(r11);
/* 8086E558 38A3001F */  addi     r5, r3, 31;
/* 8086E55C 833E008C */  lwz      r25, 140(r30);
/* 8086E560 933A0000 */  stw      r25, 0(r26);
/* 8086E564 919A0004 */  stw      r12, 4(r26);
/* 8086E568 816B0008 */  lwz      r11, 8(r11);
/* 8086E56C 917A0008 */  stw      r11, 8(r26);
/* 8086E570 817B0170 */  lwz      r11, 368(r27);
/* 8086E574 9381003C */  stw      r28, 60(r1);
/* 8086E578 93EB000C */  stw      r31, 12(r11);
/* 8086E57C 938B0010 */  stw      r28, 16(r11);
/* 8086E580 93AB0014 */  stw      r29, 20(r11);
/* 8086E584 817B0170 */  lwz      r11, 368(r27);
/* 8086E588 93E10038 */  stw      r31, 56(r1);
/* 8086E58C 930B0018 */  stw      r24, 24(r11);
/* 8086E590 839E0098 */  lwz      r28, 152(r30);
/* 8086E594 832A0004 */  lwz      r25, 4(r10);
/* 8086E598 834A0008 */  lwz      r26, 8(r10);
/* 8086E59C 819B0170 */  lwz      r12, 368(r27);
/* 8086E5A0 81490004 */  lwz      r10, 4(r9);
/* 8086E5A4 817E00A4 */  lwz      r11, 164(r30);
/* 8086E5A8 916C001C */  stw      r11, 28(r12);
/* 8086E5AC 914C0020 */  stw      r10, 32(r12);
/* 8086E5B0 81290008 */  lwz      r9, 8(r9);
/* 8086E5B4 912C0024 */  stw      r9, 36(r12);
/* 8086E5B8 813B0170 */  lwz      r9, 368(r27);
/* 8086E5BC 93A10040 */  stw      r29, 64(r1);
/* 8086E5C0 93890028 */  stw      r28, 40(r9);
/* 8086E5C4 9329002C */  stw      r25, 44(r9);
/* 8086E5C8 93490030 */  stw      r26, 48(r9);
/* 8086E5CC 813B0170 */  lwz      r9, 368(r27);
/* 8086E5D0 9381002C */  stw      r28, 44(r1);
/* 8086E5D4 90090034 */  stw      r0, 52(r9);
/* 8086E5D8 83FE00B0 */  lwz      r31, 176(r30);
/* 8086E5DC 83A80004 */  lwz      r29, 4(r8);
/* 8086E5E0 83880008 */  lwz      r28, 8(r8);
/* 8086E5E4 813B0170 */  lwz      r9, 368(r27);
/* 8086E5E8 80070004 */  lwz      r0, 4(r7);
/* 8086E5EC 811E00BC */  lwz      r8, 188(r30);
/* 8086E5F0 91090054 */  stw      r8, 84(r9);
/* 8086E5F4 90090058 */  stw      r0, 88(r9);
/* 8086E5F8 80070008 */  lwz      r0, 8(r7);
/* 8086E5FC 9009005C */  stw      r0, 92(r9);
/* 8086E600 80FB0170 */  lwz      r7, 368(r27);
/* 8086E604 93210030 */  stw      r25, 48(r1);
/* 8086E608 93E70060 */  stw      r31, 96(r7);
/* 8086E60C 93A70064 */  stw      r29, 100(r7);
/* 8086E610 93870068 */  stw      r28, 104(r7);
/* 8086E614 80FB0170 */  lwz      r7, 368(r27);
/* 8086E618 93410034 */  stw      r26, 52(r1);
/* 8086E61C 9087006C */  stw      r4, 108(r7);
/* 8086E620 819E00C8 */  lwz      r12, 200(r30);
/* 8086E624 81660004 */  lwz      r11, 4(r6);
/* 8086E628 81460008 */  lwz      r10, 8(r6);
/* 8086E62C 93E10020 */  stw      r31, 32(r1);
/* 8086E630 93A10024 */  stw      r29, 36(r1);
/* 8086E634 93810028 */  stw      r28, 40(r1);
/* 8086E638 91810014 */  stw      r12, 20(r1);
/* 8086E63C 91610018 */  stw      r11, 24(r1);
/* 8086E640 9141001C */  stw      r10, 28(r1);
/* 8086E644 38FE00D4 */  addi     r7, r30, 212;
/* 8086E648 813B0170 */  lwz      r9, 368(r27);
/* 8086E64C 81070004 */  lwz      r8, 4(r7);
/* 8086E650 38DE00E0 */  addi     r6, r30, 224;
/* 8086E654 801E00D4 */  lwz      r0, 212(r30);
/* 8086E658 389E00EC */  addi     r4, r30, 236;
/* 8086E65C 90090038 */  stw      r0, 56(r9);
/* 8086E660 3B030024 */  addi     r24, r3, 36;
/* 8086E664 38000001 */  li       r0, 1;
/* 8086E668 9109003C */  stw      r8, 60(r9);
/* 8086E66C 80E70008 */  lwz      r7, 8(r7);
/* 8086E670 90E90040 */  stw      r7, 64(r9);
/* 8086E674 80FB0170 */  lwz      r7, 368(r27);
/* 8086E678 91870044 */  stw      r12, 68(r7);
/* 8086E67C 91670048 */  stw      r11, 72(r7);
/* 8086E680 9147004C */  stw      r10, 76(r7);
/* 8086E684 80FB0170 */  lwz      r7, 368(r27);
/* 8086E688 90A70050 */  stw      r5, 80(r7);
/* 8086E68C 815E00E0 */  lwz      r10, 224(r30);
/* 8086E690 81260004 */  lwz      r9, 4(r6);
/* 8086E694 81060008 */  lwz      r8, 8(r6);
/* 8086E698 80FB0170 */  lwz      r7, 368(r27);
/* 8086E69C 80A40004 */  lwz      r5, 4(r4);
/* 8086E6A0 80DE00EC */  lwz      r6, 236(r30);
/* 8086E6A4 90C70070 */  stw      r6, 112(r7);
/* 8086E6A8 90A70074 */  stw      r5, 116(r7);
/* 8086E6AC 80840008 */  lwz      r4, 8(r4);
/* 8086E6B0 90870078 */  stw      r4, 120(r7);
/* 8086E6B4 809B0170 */  lwz      r4, 368(r27);
/* 8086E6B8 91410008 */  stw      r10, 8(r1);
/* 8086E6BC 9144007C */  stw      r10, 124(r4);
/* 8086E6C0 91240080 */  stw      r9, 128(r4);
/* 8086E6C4 91040084 */  stw      r8, 132(r4);
/* 8086E6C8 809B0170 */  lwz      r4, 368(r27);
/* 8086E6CC 9121000C */  stw      r9, 12(r1);
/* 8086E6D0 93040088 */  stw      r24, 136(r4);
/* 8086E6D4 809B0188 */  lwz      r4, 392(r27);
/* 8086E6D8 91010010 */  stw      r8, 16(r1);
/* 8086E6DC 80840000 */  lwz      r4, 0(r4);
/* 8086E6E0 98040001 */  stb      r0, 1(r4);
/* 8086E6E4 809B0188 */  lwz      r4, 392(r27);
/* 8086E6E8 80840004 */  lwz      r4, 4(r4);
/* 8086E6EC 98040002 */  stb      r0, 2(r4);
/* 8086E6F0 809B0188 */  lwz      r4, 392(r27);
/* 8086E6F4 8084000C */  lwz      r4, 12(r4);
/* 8086E6F8 98040002 */  stb      r0, 2(r4);
/* 8086E6FC 809B0188 */  lwz      r4, 392(r27);
/* 8086E700 80840008 */  lwz      r4, 8(r4);
/* 8086E704 98040003 */  stb      r0, 3(r4);
/* 8086E708 809B0188 */  lwz      r4, 392(r27);
/* 8086E70C 8084000C */  lwz      r4, 12(r4);
/* 8086E710 98040003 */  stb      r0, 3(r4);
/* 8086E714 809B0188 */  lwz      r4, 392(r27);
/* 8086E718 8084000C */  lwz      r4, 12(r4);
/* 8086E71C 98040004 */  stb      r0, 4(r4);
/* 8086E720 809B0188 */  lwz      r4, 392(r27);
/* 8086E724 80840008 */  lwz      r4, 8(r4);
/* 8086E728 98040004 */  stb      r0, 4(r4);
/* 8086E72C 809B0188 */  lwz      r4, 392(r27);
/* 8086E730 80840010 */  lwz      r4, 16(r4);
/* 8086E734 98040000 */  stb      r0, 0(r4);
/* 8086E738 881B00B1 */  lbz      r0, 177(r27);

                         slwi     r4, r0, 2;
                         addis    r4, r4, g_BalloonModels@ha;
                         lwz      r0, g_BalloonModels@l(r4);
                         stw      r0, 476(r27);

#if 0
/* 8086E73C 2C000000 */  cmpwi    r0, 0;
/* 8086E740 40820010 */  bne-     UNDEF_8086e750;
/* 8086E744 3803002E */  addi     r0, r3, 46;
/* 8086E748 901B01DC */  stw      r0, 476(r27);
/* 8086E74C 48000014 */  b        UNDEF_8086e760;
UNDEF_8086e750:;
/* 8086E750 28000001 */  cmplwi   r0, 1;
/* 8086E754 4082000C */  bne-     UNDEF_8086e760;
/* 8086E758 38030035 */  addi     r0, r3, 53;
/* 8086E75C 901B01DC */  stw      r0, 476(r27);
UNDEF_8086e760:;
/* 8086E760 881B00B1 */  lbz      r0, 177(r27);
/* 8086E764 2C000000 */  cmpwi    r0, 0;
/* 8086E768 408200AC */  bne-     UNDEF_8086e814;
#endif
/* 8086E76C 3C80808B */  lis      r4, UNDEF_808b2258@ha;
/* 8086E770 3860007C */  li       r3, 124;
/* 8086E774 38842258 */  addi     r4, r4, UNDEF_808b2258@l;
/* 8086E778 3B04003E */  addi     r24, r4, 62;
/* 8086E77C 4B9BB651 */  bl       UNDEF_80229dcc;
/* 8086E780 2C030000 */  cmpwi    r3, 0;
/* 8086E784 41820010 */  beq-     UNDEF_8086e794;
/* 8086E788 7F04C378 */  mr       r4, r24;
/* 8086E78C 38A00000 */  li       r5, 0;
/* 8086E790 4B9B453D */  bl       UNDEF_80222ccc;
UNDEF_8086e794:;
/* 8086E794 80DB01D8 */  lwz      r6, 472(r27);
/* 8086E798 3C80808B */  lis      r4, UNDEF_808b2218@ha;
/* 8086E79C 3F80808B */  lis      r28, UNDEF_808b2234@ha;
/* 8086E7A0 38A00000 */  li       r5, 0;
/* 8086E7A4 90660000 */  stw      r3, 0(r6);
/* 8086E7A8 38000001 */  li       r0, 1;
UNDEF_8086e7ac:;
/* 8086E7AC C0242218 */  lfs      f1, UNDEF_808b2218@l(r4);
/* 8086E7B0 807B01D8 */  lwz      r3, 472(r27);
/* 8086E7B4 C01C2234 */  lfs      f0, UNDEF_808b2234@l(r28);
/* 8086E7B8 98A30004 */  stb      r5, 4(r3);
/* 8086E7BC 807B01D8 */  lwz      r3, 472(r27);
/* 8086E7C0 90A30008 */  stw      r5, 8(r3);
/* 8086E7C4 807B01D8 */  lwz      r3, 472(r27);
UNDEF_8086e7c8:;
/* 8086E7C8 9803000C */  stb      r0, 12(r3);
/* 8086E7CC 807B01D8 */  lwz      r3, 472(r27);
/* 8086E7D0 90A30010 */  stw      r5, 16(r3);
/* 8086E7D4 807B01D8 */  lwz      r3, 472(r27);
/* 8086E7D8 D023001C */  stfs     f1, 28(r3);
/* 8086E7DC D0230018 */  stfs     f1, 24(r3);
/* 8086E7E0 D0230014 */  stfs     f1, 20(r3);
/* 8086E7E4 807B01D8 */  lwz      r3, 472(r27);
UNDEF_8086e7e8:;
/* 8086E7E8 D0030020 */  stfs     f0, 32(r3);
/* 8086E7EC D0030024 */  stfs     f0, 36(r3);
/* 8086E7F0 D0030028 */  stfs     f0, 40(r3);
/* 8086E7F4 807B01D8 */  lwz      r3, 472(r27);
/* 8086E7F8 3863002C */  addi     r3, r3, 44;
/* 8086E7FC 4B9C12C9 */  bl       UNDEF_8022fac4;
/* 8086E800 807B01D8 */  lwz      r3, 472(r27);
/* 8086E804 C01C2234 */  lfs      f0, UNDEF_808b2234@l(r28);
UNDEF_8086e808:;
/* 8086E808 D003005C */  stfs     f0, 92(r3);
/* 8086E80C D0030060 */  stfs     f0, 96(r3);
/* 8086E810 480000B0 */  b        UNDEF_8086e8c0;
UNDEF_8086e814:;
/* 8086E814 28000001 */  cmplwi   r0, 1;
/* 8086E818 408200A8 */  bne-     UNDEF_8086e8c0;
/* 8086E81C 3C80808B */  lis      r4, UNDEF_808b2258@ha;
UNDEF_8086e820:;
/* 8086E820 3860007C */  li       r3, 124;
/* 8086E824 38842258 */  addi     r4, r4, UNDEF_808b2258@l;
/* 8086E828 3B040049 */  addi     r24, r4, 73;
/* 8086E82C 4B9BB5A1 */  bl       UNDEF_80229dcc;
/* 8086E830 2C030000 */  cmpwi    r3, 0;
/* 8086E834 41820010 */  beq-     UNDEF_8086e844;
UNDEF_8086e838:;
/* 8086E838 7F04C378 */  mr       r4, r24;
/* 8086E83C 38A00000 */  li       r5, 0;
/* 8086E840 4B9B448D */  bl       UNDEF_80222ccc;
UNDEF_8086e844:;
/* 8086E844 80DB01D8 */  lwz      r6, 472(r27);
/* 8086E848 3C80808B */  lis      r4, UNDEF_808b2218@ha;
/* 8086E84C 3F80808B */  lis      r28, UNDEF_808b2234@ha;
/* 8086E850 38A00000 */  li       r5, 0;
/* 8086E854 90660000 */  stw      r3, 0(r6);
UNDEF_8086e858:;
/* 8086E858 38000001 */  li       r0, 1;
/* 8086E85C C0242218 */  lfs      f1, UNDEF_808b2218@l(r4);
/* 8086E860 807B01D8 */  lwz      r3, 472(r27);
/* 8086E864 C01C2234 */  lfs      f0, UNDEF_808b2234@l(r28);
/* 8086E868 98A30004 */  stb      r5, 4(r3);
/* 8086E86C 807B01D8 */  lwz      r3, 472(r27);
UNDEF_8086e870:;
/* 8086E870 90A30008 */  stw      r5, 8(r3);
/* 8086E874 807B01D8 */  lwz      r3, 472(r27);
/* 8086E878 9803000C */  stb      r0, 12(r3);
/* 8086E87C 807B01D8 */  lwz      r3, 472(r27);
/* 8086E880 90A30010 */  stw      r5, 16(r3);
/* 8086E884 807B01D8 */  lwz      r3, 472(r27);
/* 8086E888 D023001C */  stfs     f1, 28(r3);
UNDEF_8086e88c:;
/* 8086E88C D0230018 */  stfs     f1, 24(r3);
/* 8086E890 D0230014 */  stfs     f1, 20(r3);
/* 8086E894 807B01D8 */  lwz      r3, 472(r27);
/* 8086E898 D0030020 */  stfs     f0, 32(r3);
/* 8086E89C D0030024 */  stfs     f0, 36(r3);
/* 8086E8A0 D0030028 */  stfs     f0, 40(r3);
/* 8086E8A4 807B01D8 */  lwz      r3, 472(r27);
UNDEF_8086e8a8:;
/* 8086E8A8 3863002C */  addi     r3, r3, 44;
/* 8086E8AC 4B9C1219 */  bl       UNDEF_8022fac4;
/* 8086E8B0 807B01D8 */  lwz      r3, 472(r27);
/* 8086E8B4 C01C2234 */  lfs      f0, UNDEF_808b2234@l(r28);
/* 8086E8B8 D003005C */  stfs     f0, 92(r3);
/* 8086E8BC D0030060 */  stfs     f0, 96(r3);
UNDEF_8086e8c0:;
/* 8086E8C0 386000B8 */  li       r3, 184;
UNDEF_8086e8c4:;
/* 8086E8C4 4B9BB509 */  bl       UNDEF_80229dcc;
/* 8086E8C8 2C030000 */  cmpwi    r3, 0;
/* 8086E8CC 41820008 */  beq-     UNDEF_8086e8d4;
/* 8086E8D0 4BE9E1BD */  bl       UNDEF_8070ca8c;
UNDEF_8086e8d4:;
/* 8086E8D4 2C030000 */  cmpwi    r3, 0;
/* 8086E8D8 41820008 */  beq-     UNDEF_8086e8e0;
/* 8086E8DC 38630094 */  addi     r3, r3, 148;
UNDEF_8086e8e0:;
/* 8086E8E0 907B0018 */  stw      r3, 24(r27);
/* 8086E8E4 7F63DB78 */  mr       r3, r27;
/* 8086E8E8 E3E10088 */  .long    0xE3E10088; // psq_l    f31, 136(r1), 0, 0;
UNDEF_8086e8ec:;
/* 8086E8EC CBE10080 */  lfd      f31, 128(r1);
/* 8086E8F0 E3C10078 */  .long    0xE3C10078; // psq_l    f30, 120(r1), 0, 0;
/* 8086E8F4 CBC10070 */  lfd      f30, 112(r1);
/* 8086E8F8 39610070 */  addi     r11, r1, 112;
/* 8086E8FC 4B7B2CE5 */  bl       UNDEF_800215e0;
/* 8086E900 80010094 */  lwz      r0, 148(r1);
/* 8086E904 7C0803A6 */  mtlr     r0;
UNDEF_8086e908:;
/* 8086E908 38210090 */  addi     r1, r1, 144;
/* 8086E90C 4E800020 */  blr;
  // clang=format on
);
